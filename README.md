# DemoUserService API #

**DemoUserService  API** - демо RESTful API, предоставляющее возможность регистрации и входа с логином и паролем. Также при регистрации на почту пользователя отправляется сообщение для подтверждения почты.

## Технологии ##
API написан на языке **Kotlin** с использованием **Spring Boot** для внедрения зависимотей. Также важно отметить:
* для осуществления авторизации используеются **Spring Security**;
* для хранения и управления данными используется СУБД **PostgreSQL**;
* для взаимодействия с СУБД используется **Hibernate**;
* для документирования API используется **Swagger**;
* для отправки сообщений используется другой сервис, иснтрукции для которого отправляются посредством **Apache Kafka**.

## Структура проекта ##
Далее описаны основные составляющие проекта.

### Структура хранения в базе данных ###

Можно выделить 1 сущность в базе данных и это непосредственно пользователь (User).Она содержит следующие поля:
1. _id_ - уникальный идентификатор пользователя;
2. _login_ - логин для входа;
3. _email_ - электронная почта пользователя;
4. _password_ - пароль для входа;
5. _confirmation_ - флаг, сигнализирующий о наличии подтверждения почты;
6. _bio_ - информация о себе (опциональная информация).

### Авторизация ###

Для доступа ко всем эндпоинтам API используется базовая авторизация.
Существует 2 роли: 
* _COMMON_ -  авторизированный пользователь, который может поличить и зменить свои данные;
* _ADMIN_ - администратор, который может просматривать всех пользователей.
В API есть несколько эндпоинтов для проверки работы авторизации, о которых чуть дальше.
### Доступные эндпоинты ###


[//]: # (![Список эндпоинтов для контроллера категорий]&#40;img/controller.png&#41;)

### Модели доступа к данным ###


### Отправка сообщений в DemoMailService ###
Сообщения об инстуркциях для отправления писем отправляются в отдельный [DemoMailService](https://github.com/Octopus122/DemoMailService). 
Каждая инструкция имеет содержит следующую информацию:
1. адрес электронной почты, на которую необходимо отправить письмо;
2. тип письма (в нынешней реализации отправлются только письма для подтвержения почты);
3. данные - дополнительная информация, которой нужно дополнить письмо (например ссылка для подтверждения).

Как было сказано ранее инструкции отпрвляются при помощи Apache Kafka. Для того, чтобы предотвратить торможение и полное блокирование сервера при наличии
ошибок во время работы с брокером, максимальное время попытки осуществить отправку сообщений от продьюсера было выставлено 10 секунд.  

Также исключения, возникающие при работе брокера обрабатываются, о чем подробнее в следующем пункте.

### Обработка ошибок ###


### Дополнительная информация ###
Значительная часть переменных передается с помощью .env. Для демонстрации списка этих переменных используется .env.example.

## TO DO ##
- [ ] Написать про эндпоинты;
- [ ] Написать про модели данных;
- [ ] Написать про обработку ошибок;
- [x] Добавить обработку ошибок;
- [x] Добавить таймаут для отправки сообщений в Kafka
- [x] Добавить возможность повтроно отправить запрос на подтверждение почты;
- [ ] Добавить возможность смены пароля;
- [ ] Добавить возможность смены почты;
- [ ] Добавить UserDetailService, получающий данные пользователя из базы данных;
- [ ] Сделать контроллеры асинхронными (по возможности, может и нет).